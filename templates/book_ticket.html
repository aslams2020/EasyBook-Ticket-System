<!-- templates/book_ticket.html -->
{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">Book Tickets for {{ showtime.title }}</h3>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <p><strong>Theater:</strong> {{ showtime.theater_name }}</p>
                        <p><strong>Showtime:</strong> {{ showtime.showtime }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Available Seats:</strong> <span id="available-seats">{{ showtime.available_seats }}</span></p>
                        <p><strong>Price per Ticket:</strong> $<span id="ticket-price">{{ "%.2f"|format(showtime.price) }}</span></p>
                    </div>
                </div>

                <form method="POST" id="booking-form">
                    <div class="mb-3">
                        <label for="tickets" class="form-label">Number of Tickets</label>
                        <input type="number" class="form-control" id="tickets" name="tickets" 
                               min="1" max="{{ showtime.available_seats }}" value="1" required>
                        <div class="form-text">Maximum {{ showtime.available_seats }} tickets available</div>
                    </div>

                    <div class="alert alert-info mt-3">
                        <h5>Order Summary</h5>
                        <p id="order-summary">1 ticket x ${{ "%.2f"|format(showtime.price) }} = ${{ "%.2f"|format(showtime.price) }}</p>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('movie_details', movie_id=showtime.movie_id) }}" class="btn btn-secondary me-md-2">Cancel</a>
                        <button type="submit" class="btn btn-primary">Continue to Checkout</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const ticketsInput = document.getElementById('tickets');
    const availableSeats = parseInt(document.getElementById('available-seats').textContent);
    const ticketPrice = parseFloat(document.getElementById('ticket-price').textContent);
    const orderSummary = document.getElementById('order-summary');
    
    function updateOrderSummary() {
        const numTickets = parseInt(ticketsInput.value) || 0;
        const totalPrice = (ticketPrice * numTickets).toFixed(2);
        orderSummary.textContent = `${numTickets} ticket${numTickets !== 1 ? 's' : ''} x $${ticketPrice.toFixed(2)} = $${totalPrice}`;
    }
    
    ticketsInput.addEventListener('input', function() {
        let numTickets = parseInt(this.value) || 0;
        
        // Validate input
        if (numTickets < 1) {
            numTickets = 1;
            this.value = 1;
        } else if (numTickets > availableSeats) {
            numTickets = availableSeats;
            this.value = availableSeats;
            alert(`Only ${availableSeats} seats available!`);
        }
        
        updateOrderSummary();
    });
    
    // Initialize order summary
    updateOrderSummary();
});
</script>
{% endblock %}